resources:
  - name: S_B_BuildInfo_0001_buildInfo
    type: BuildInfo
    configuration:
      sourceArtifactory: s_artifactory

pipelines:
  - name: S_B_BuildInfo_0001
    steps:
      - name: S_B_BuildInfo_0001_1
        type: Bash
        configuration:
          environmentVariables:
            targetRepo: test-automation-generic-local
          integrations:
            - name: s_artifactory
          outputResources:
            - name: S_B_BuildInfo_0001_buildInfo
        execution:
          onExecute:
            - echo "Content-${run_number}" > artifact.txt
            - jfrog rt upload artifact.txt ${targetRepo}/S_B_BuildInfo_0001-artifact-${run_number}.txt
            - jfrog rt build-publish
            - write_output S_B_BuildInfo_0001_buildInfo "buildNumber=$run_number"

      - name: S_B_BuildInfo_0001_2
        type: Bash
        configuration:
          inputResources:
            - name: S_B_BuildInfo_0001_buildInfo
        execution:
          onExecute:
            - buildInfoApiUrl="$res_S_B_BuildInfo_0001_buildInfo_sourceArtifactory_url/api/build/$res_S_B_BuildInfo_0001_buildInfo_buildName/$res_S_B_BuildInfo_0001_buildInfo_buildNumber"
            - buildUrl=$(curl -u $res_S_B_BuildInfo_0001_buildInfo_sourceArtifactory_user:$res_S_B_BuildInfo_0001_buildInfo_sourceArtifactory_apikey $buildInfoApiUrl | jq .buildInfo.url)
            - echo $buildUrl
